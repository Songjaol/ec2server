name: Spring Boot Build (All Branches)

on:
  push:
    branches: ["**"]        # 모든 브랜치 push
  pull_request:
    branches: ["**"]        # 모든 브랜치 PR
  workflow_dispatch:        # 수동 실행 가능

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      ##################################################
      # 1) 코드 체크아웃
      ##################################################
      - name: Checkout project
        uses: actions/checkout@v4

      ##################################################
      # 2) 프로젝트 위치 자동 탐지
      ##################################################
      - name: Detect project directory
        id: detect
        run: |
          if [ -d "./feature/server" ]; then
            echo "project_dir=./feature/server" >> $GITHUB_OUTPUT
          else
            echo "project_dir=." >> $GITHUB_OUTPUT
          fi

      ##################################################
      # 3) JDK 설정 (Java 21)
      ##################################################
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: "21"
          distribution: "temurin"

      ##################################################
      # 4) gradlew 실행 권한 부여
      ##################################################
      - name: Make gradlew executable
        run: chmod +x ${{ steps.detect.outputs.project_dir }}/gradlew

      ##################################################
      # 5) Spring Boot Build (테스트 생략)
      ##################################################
      - name: Build (skip tests)
        run: |
          cd ${{ steps.detect.outputs.project_dir }}
          ./gradlew clean build -x test
